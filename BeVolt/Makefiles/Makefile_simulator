TARGET = bps-simulator.out

CC = gcc

SRC = \
$(wildcard Apps/Src/*.c) \
$(wildcard BSP/Simulator/Src/*.c) \
$(wildcard Drivers/Src/*.c) \
$(wildcard Config/Src/*.c)

INC_DIR = \
-IApps/Inc \
-IBSP/Inc \
-IDrivers/Inc \
-IConfig/Inc

LIB = \
-lm

FLAGS = -Wall -g -std=c11 $(INC_DIR)

BUILD_DIR = Objects
OBJ = $(addprefix $(BUILD_DIR)/,$(notdir $(SRC:.c=.o)))
vpath %.c $(sort $(dir $(SRC)))

all: $(TARGET)

$(BUILD_DIR)/%.o: %.c $(BUILD_DIR)
	$(CC) -c -o $@ $< $(FLAGS)

$(TARGET): $(OBJ) $(BUILD_DIR)
	$(CC) -o $@ $(OBJ) $(FLAGS) $(LIB)

$(BUILD_DIR):
	mkdir $@

.PHONY: clean

clean:
	rm -fR $(BUILD_DIR)
